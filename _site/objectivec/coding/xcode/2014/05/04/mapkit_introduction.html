<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Introduction to MapKit on IOS</title>
        <meta name="viewport" content="width=device-width">
        <link rel="stylesheet" href="/css/syntax.min.css">
        <script src="/css/jquery.min.js"></script>
        <link rel="stylesheet" href="/css/bootstrap.min.css">
		<link rel="stylesheet" href="/css/bootstrap-theme.min.css">		
		<script src="/css/bootstrap.min.js"></script>
		<link href="/css/additional.min.css" rel="stylesheet">
		<link rel="alternate" type="application/rss+xml" title="AndyDunkel.net RSS Feed" href="http://andydunkel.net/rss.xml" /> 
		
		<!-- Begin Cookie Consent plugin by Silktide - http://silktide.com/cookieconsent -->
	    <script type="text/javascript">
		    window.cookieconsent_options = {"message":"Wir verwenden Cookies auf der Website, um Ihren Besuch effizienter zu machen und Ihnen Benutzerfreundlichkeit bieten zu können.","dismiss":"OK","learnMore":"Mehr Informationen","link":"http://ekiwi.de/datenschutzerklaerung.htm","theme":"light-bottom"};
		</script>
		
		<script type="text/javascript" src="http://www.andydunkel.net/css/cookieconsent/cookieconsent.min.js"></script>
		<!-- End Cookie Consent plugin -->
		
    </head>
    <body>
    
    <div class="container">
    	<div class="col-md-4">
	    	<a href="/index.html">
    			<img src="/assets/logo.png" alt="logo" width="300" height="113">
    		</a>
    	</div>
    	<div class="col-md-8" style="padding:20px">
			<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
			<!-- eKiwiTop -->
			<ins class="adsbygoogle"
			     style="display:inline-block;width:728px;height:90px"
			     data-ad-client="ca-pub-1137550895446814"
			     data-ad-slot="2555817477"></ins>
			<script>
			(adsbygoogle = window.adsbygoogle || []).push({});
			</script> 		
    	</div>
    </div>

    <!-- Fixed navbar -->
    <div class="navbar navbar-default">
      <div class="container">
	     
        <div class="navbar-header">	
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          
          <a class="navbar-brand" href="/index.html">Home</a>
        </div>
       
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li><a href="/blog.html">Blog</a></li>
            
            <li class="dropdown">
              <a href="/projects.html" class="dropdown-toggle" data-toggle="dropdown">Projekte <b class="caret"></b></a>
              <ul class="dropdown-menu">
	            <li class="dropdown-header">Webseiten</li>
                <li><a href="http://ekiwi.de">eKiwi.de</a></li>
                <li><a href="http://acapio.de">Acapio.de</a></li>
                <li><a href="http://da-software.de">DA-Software.de</a></li>
                <li class="divider"></li>
	               <li class="dropdown-header">Blogs</li>
				        <li><a href="http://blog.ekiwi.de">eKiwi Blog</a></li>				
                <li class="divider"></li>
                <li class="dropdown-header">Sonstiges</li>
                <li><a href="/documents.html">Dokumente</a></li>
               </ul>
            </li>           
            
            <li class="dropdown">
              <a href="/software.html" class="dropdown-toggle" data-toggle="dropdown">Software <b class="caret"></b></a>
              <ul class="dropdown-menu">
	            <li class="dropdown-header">OpenSource</li>  
	            <li><a href="https://github.com/andydunkel?tab=repositories">GitHub Projekte</a></li>
	            <li class="divider"></li>
	            <li class="dropdown-header">Kommerzielle Software</li>
                <li><a href="http://da-software.de/daform/daform_start.htm">DA-FormMaker</a></li>
                <li><a href="http://da-software.de/dabestell/index.htm">DA-BestellFormular</a></li>
                <li><a href="http://da-software.de/daquiz/index.htm">DA-QuizMaker</a></li>
                <li><a href="http://da-software.de/dahtaccess/dahtaccess_start.htm">DA-HtAccessManager</a></li>                
              </ul>
            </li>
            
            <li class="dropdown">
              <a href="/guides/index.html" class="dropdown-toggle" data-toggle="dropdown">Anleitungen / Tutorials <b class="caret"></b></a>
              <ul class="dropdown-menu">
	            <li><a href="/guides/repair/index.html">Reparaturanleitungen</a></li>
              <li><a href="/guides/software/index.html">Software</a></li>              
              </ul>
            </li>
                        
            
            <li><a href="/about.html">Persönliches</a></li>
            <li><a href="/contact.html">Kontakt</a></li>            
            <li><a href="/imprint.html">Impressum</a></li>
          </ul>
          <ul class="nav navbar-nav navbar-right">
          	<li>
          	<form action="http://www.google.de" id="cse-search-box" class="navbar-form navbar-left" role="search">
			  <div class="form-group">
			    <input type="hidden" name="cx" value="partner-pub-1137550895446814:8857383477" />
			    <input type="hidden" name="ie" value="UTF-8" />
			    <input type="text" name="q" size="20" class="form-control"/>
			  </div>
			    <input type="submit" name="sa" value="Search" class="btn btn-default"/>			
			  </form>
				<script type="text/javascript" src="http://www.google.de/coop/cse/brand?form=cse-search-box&amp;lang=de"></script>
          	</li>            
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </div>

    <div class="container">

        <div class="row">
    	<div class="col-md-9">

			<h2>Introduction to MapKit on IOS</h2>
			<p class="meta">04 May 2014</p>
			
			<div class="post">
			<p>MapKit offers an easy way to integrate Apple maps into your app. Wether you want to show where your company is located, where the next pub is or track your cats GPS location in an app.</p>

<p>In this tutorial I want to describe how you can add maps to your application. Position, zoom the map and add annotations. </p>

<h2>Create the project</h2>

<p>In XCode create a new project, select iOS and single view application and enter the details for project. Once the project is created. The first thing we are doing, is adding the MapKit to the linked frameworks:</p>

<p><img src="http://andydunkel.net/assets/uploads/2014/05/mapkit/mapkit_1.png" alt="image"></p>

<p>Otherwise the application will crash instantaneously. Once we have done that, we go to the main storyboard and drag the map view into our view.</p>

<p><img src="http://andydunkel.net/assets/uploads/2014/05/mapkit/mapkit_2.png" alt="image"></p>

<p>In the properties of the MapView you can configure some basic settings, like showing the users location, activate / deactive zooming, rotating, scrolling etc...</p>

<p>The next step is to create the Outlet for the map view in our application. This can be done using the Assistant editor and CTRL dragging the MKMapView onto the header file and enter a name for the variable:</p>

<p><img src="http://andydunkel.net/assets/uploads/2014/05/mapkit/mapkit_3.png" alt="image"></p>

<p>We also need to add MapKit to the imports. While we are doing that we also add the map delegate:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">#import &lt;MapKit/MapKit.h&gt;

@interface DASViewController : UIViewController &lt;MKMapViewDelegate&gt;
</code></pre></div>
<p>Lets run the app for the first time. It should now display the map.</p>

<h2>Setting the Map Type</h2>

<p>For maps there are three types how to display the map: Standard, Satellite and Hybrid. While you can set these in the properties, you might want the user to be able to choose the type.</p>

<p>For that we are adding a segmented control to the view and CTRL drag an IBAction to our .m file:</p>

<p><img src="http://andydunkel.net/assets/uploads/2014/05/mapkit/mapkit_4.png" alt="image"></p>

<p>...and implement the action method:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">    - (IBAction)setType:(UISegmentedControl *)sender {
    switch (sender.selectedSegmentIndex) {
        case 0:
            self.mapView.mapType = MKMapTypeStandard;
            break;
        case 1:
            self.mapView.mapType = MKMapTypeSatellite;
            break;
        case 2:
            self.mapView.mapType = MKMapTypeHybrid;
            break;
        default:
            break;
    }
}
</code></pre></div>
<p>When we start the application we are now able to switch between the different map types.</p>

<h2>Zoom to a specific location</h2>

<p>While the map currently defaults to specific position, we now want to set a location / area on our own by default.</p>

<p>To do that, we add the following code to our <code>viewDidLoad</code> method:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">- (void)viewDidLoad
{
    [super viewDidLoad];
    // Create your coordinate
    CLLocationCoordinate2D myCoordinate = {47.879854, 10.641000};

    //set location and zoom level
    MKCoordinateRegion viewRegion = MKCoordinateRegionMakeWithDistance(myCoordinate, 1000, 1000);
    MKCoordinateRegion adjustedRegion = [self.mapView regionThatFits:viewRegion];
    [self.mapView setRegion:adjustedRegion animated:YES];

}
</code></pre></div>
<p>Lets have a look to the details:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">CLLocationCoordinate2D myCoordinate = {47.879854, 10.641000};
</code></pre></div>
<p>Coordinates are longitude and latitude of the position. Best way to find out for a place is Google Maps. The zoom level is adjusted in the following line:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">MKCoordinateRegion viewRegion = MKCoordinateRegionMakeWithDistance(myCoordinate, 1000, 1000);
</code></pre></div>
<p>This is defined in metres, in our case we want to have a 1000 meters zoom level. When we launch the app now, it should default to the given position.</p>

<h2>Add annotation</h2>

<p>The next step for us is to add an annotation to the map. We add the following code to the <code>viewDidLoad</code> method:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text"> //Create your annotation
MKPointAnnotation *point = [[MKPointAnnotation alloc] init];
// Set your annotation to point at your coordinate
point.coordinate = myCoordinate;
point.title = @&quot;Andys Home&quot;;

//Drop pin on map
[self.mapView addAnnotation:point];
</code></pre></div>
<p>The code is best added before we do the zoom we did before.</p>

<h3>Remove all annotations</h3>

<p>To remove all annotations from the map:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">for (id annotation in self.mapView.annotations) {
    [self.mapView removeAnnotation:annotation];
}
</code></pre></div>
<h3>Showing the users location</h3>

<p>The last thing we want to do is do something with users location. The users location is only available if the user enabled the function. The user is asked wether he wants to share his location or not, when the function is first called. To enable that in XCode activate &quot;Show Users Location&quot; in the MapViews properties.</p>

<p>Also drop a label on the view and create an outlet for it:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">@property (weak, nonatomic) IBOutlet UILabel *labelPosition;
</code></pre></div>
<p>To update the user location, we are using the delegate we defined in our header file and assign the delegate to the mapView:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">self.mapView.delegate = self;
</code></pre></div>
<p>Now we implement the method for the update:</p>
<div class="highlight"><pre><code class="language-text" data-lang="text">-(void)mapView:(MKMapView *)mapView didUpdateUserLocation:(MKUserLocation *)userLocation {

    CLLocationCoordinate2D myCoordinate = {47.879854, 10.641000};
    CLLocationCoordinate2D userCoordinate = [[[self.mapView userLocation]
                                              location] coordinate];

    CLLocation *myLoc = [[CLLocation alloc] initWithLatitude:myCoordinate.latitude
                                                   longitude:myCoordinate.longitude];
    CLLocation *userLoc = [[CLLocation alloc] initWithLatitude:userCoordinate.latitude
                                                     longitude:userCoordinate.longitude];

    CLLocationDistance distance = [myLoc distanceFromLocation:userLoc];

    NSString *labelText = [NSString stringWithFormat:@&quot;%lf km&quot;, distance / 1000];

    [self.labelPosition setText:labelText];
}
</code></pre></div>
<p>The method gets called everytime the user position gets updated. It calculates the distance between the users position and the predefined location. The result is then shown on the label we just dropped on the view:</p>

<p><img src="http://andydunkel.net/assets/uploads/2014/05/mapkit/mapkit_5.png" alt="image"></p>

<h2>The end</h2>

<p>Well thats it for some quickstart with MapKit. You can download the source code of the <a href="http://andydunkel.net/assets/uploads/2014/05/mapkit/MapKitExample.zip">example here</a>.</p>

			</div>
			
			<script type="text/javascript"><!--
			google_ad_client = "ca-pub-1137550895446814";
			/* 468x60, Erstellt 21.03.09 */
			google_ad_slot = "2357680339";
			google_ad_width = 468;
			google_ad_height = 60;
			//-->
			</script>
			<script type="text/javascript"
			src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
			</script>
    	</div>
    	
    	<div class="col-md-3" align="center">  
    		<div class="panel panel-default sideBarTop">    			
	    		<script id='fb7sm2s'>(function(i){var f,s=document.getElementById(i);f=document.createElement('iframe');f.src='//api.flattr.com/button/view/?uid=mengenleere&button=compact&url='+encodeURIComponent(document.URL);f.title='Flattr';f.height=20;f.width=110;f.style.borderWidth=0;s.parentNode.insertBefore(f,s);})('fb7sm2s');</script>    		
    		</div>
    	  	
    		<div class="panel panel-default">
	    		<div class="panel-body">
				<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
				<!-- Seitenleiste -->
				<ins class="adsbygoogle"
				     style="display:inline-block;width:160px;height:600px"
				     data-ad-client="ca-pub-1137550895446814"
				     data-ad-slot="1909195079"></ins>
				<script>
				(adsbygoogle = window.adsbygoogle || []).push({});
				</script>		    	
	    		</div>
    		</div>
    	</div>    	
    	
    </div>			

<hr>

<div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'andydunkelnet'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    </div>
    
<!-- Piwik -->
<script type="text/javascript">
  var _paq = _paq || [];
  _paq.push(["trackPageView"]);
  _paq.push(["enableLinkTracking"]);

  (function() {
    var u=(("https:" == document.location.protocol) ? "https" : "http") + "://piwik.ekiwi.de/";
    _paq.push(["setTrackerUrl", u+"piwik.php"]);
    _paq.push(["setSiteId", "2"]);
    var d=document, g=d.createElement("script"), s=d.getElementsByTagName("script")[0]; g.type="text/javascript";
    g.defer=true; g.async=true; g.src=u+"piwik.js"; s.parentNode.insertBefore(g,s);
  })();
</script>
<!-- End Piwik Code -->

    </body>
</html>
