<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Windows Forms on OSX - Clipboard not working</title>
        <meta name="viewport" content="width=device-width">
        <link rel="stylesheet" href="/css/syntax.min.css">
        <script src="/css/jquery.min.js"></script>
        <link rel="stylesheet" href="/css/bootstrap.min.css">
		<link rel="stylesheet" href="/css/bootstrap-theme.min.css">		
		<script src="/css/bootstrap.min.js"></script>
		<link href="/css/additional.min.css" rel="stylesheet">
		<link rel="alternate" type="application/rss+xml" title="AndyDunkel.net RSS Feed" href="http://andydunkel.net/rss.xml" /> 
		
		<!-- Begin Cookie Consent plugin by Silktide - http://silktide.com/cookieconsent -->
    <link rel="stylesheet" type="text/css" href="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.0.3/cookieconsent.min.css" />
    <script src="//cdnjs.cloudflare.com/ajax/libs/cookieconsent2/3.0.3/cookieconsent.min.js"></script>
    <script>
    window.addEventListener("load", function(){
    window.cookieconsent.initialise({
      "palette": {
        "popup": {
          "background": "#edeff5",
          "text": "#838391"
        },
        "button": {
          "background": "#4b81e8"
        }
      },
      "theme": "edgeless",
      "content": {
        "message": "Wir verwenden Cookies auf der Website, um Ihren Besuch effizienter zu machen und Ihnen Benutzerfreundlichkeit bieten zu können.",
        "dismiss": "OK",
        "link": "Informationen",
        "href": "http://ekiwi.de/datenschutzerklaerung.htm"
      }
    })});
    </script>
		<!-- End Cookie Consent plugin -->
		
    </head>
    <body>
    
    <div class="container">
    	<div class="col-md-4">
	    	<a href="/index.html">
    			<img src="/assets/logo.png" alt="logo" width="300" height="113">
    		</a>
    	</div>
    	<div class="col-md-8" style="padding:20px">
			<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
			<!-- eKiwiTop -->
			<ins class="adsbygoogle"
			     style="display:inline-block;width:728px;height:90px"
			     data-ad-client="ca-pub-1137550895446814"
			     data-ad-slot="2555817477"></ins>
			<script>
			(adsbygoogle = window.adsbygoogle || []).push({});
			</script> 		
    	</div>
    </div>

    <!-- Fixed navbar -->
    <div class="navbar navbar-default">
      <div class="container">
	     
        <div class="navbar-header">	
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          
          <a class="navbar-brand" href="/index.html">Home</a>
        </div>
       
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li><a href="/blog.html">Blog</a></li>
            
            <li class="dropdown">
              <a href="/projects.html" class="dropdown-toggle" data-toggle="dropdown">Projekte <b class="caret"></b></a>
              <ul class="dropdown-menu">
	            <li class="dropdown-header">Webseiten</li>
                <li><a href="http://ekiwi.de">eKiwi.de</a></li>
                <li><a href="http://acapio.de">Acapio.de</a></li>
                <li><a href="http://da-software.de">DA-Software.de</a></li>
                <li><a href="http://eltexto.net">ElTexto</a></li>
                <li class="divider"></li>
	               <li class="dropdown-header">Blogs</li>
				        <li><a href="http://ekiwi-blog.de">eKiwi Blog</a></li>				
                <li class="divider"></li>
                <li class="dropdown-header">Sonstiges</li>
                <li><a href="/documents.html">Dokumente</a></li>
               </ul>
            </li>           
            
            <li class="dropdown">
              <a href="/software.html" class="dropdown-toggle" data-toggle="dropdown">Software <b class="caret"></b></a>
              <ul class="dropdown-menu">
	            <li class="dropdown-header">OpenSource</li>  
	            <li><a href="https://github.com/andydunkel?tab=repositories">GitHub Projekte</a></li>
	            <li class="divider"></li>
	            <li class="dropdown-header">Kommerzielle Software</li>
	            <li><a href="http://eltexto.net">El Texto</a></li>
                <li><a href="http://da-software.de/daform/daform_start.htm">DA-FormMaker</a></li>
                <li><a href="http://da-software.de/dabestell/index.htm">DA-BestellFormular</a></li>
                <li><a href="http://da-software.de/daquiz/index.htm">DA-QuizMaker</a></li>
                <li><a href="http://da-software.de/dahtaccess/dahtaccess_start.htm">DA-HtAccessManager</a></li>                
              </ul>
            </li>
            
            <li class="dropdown">
              <a href="/guides/index.html" class="dropdown-toggle" data-toggle="dropdown">Anleitungen / Tutorials <b class="caret"></b></a>
              <ul class="dropdown-menu">
	            <li><a href="/guides/repair/index.html">Reparaturanleitungen</a></li>
              <li><a href="/guides/software/index.html">Software</a></li>              
              </ul>
            </li>
                        
            
            <li><a href="/about.html">Persönliches</a></li>
            <li><a href="/contact.html">Kontakt</a></li>            
            <li><a href="/imprint.html">Impressum</a></li>
          </ul>
          <ul class="nav navbar-nav navbar-right">
          	<li>
          	<form action="http://www.google.de" id="cse-search-box" class="navbar-form navbar-left" role="search">
			  <div class="form-group">
			    <input type="hidden" name="cx" value="partner-pub-1137550895446814:8857383477" />
			    <input type="hidden" name="ie" value="UTF-8" />
			    <input type="text" name="q" size="20" class="form-control"/>
			  </div>
			    <input type="submit" name="sa" value="Search" class="btn btn-default"/>			
			  </form>
				<script type="text/javascript" src="http://www.google.de/coop/cse/brand?form=cse-search-box&amp;lang=de"></script>
          	</li>            
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </div>

    <div class="container">

        <div class="row">
    	<div class="col-md-9">

			<h2>Windows Forms on OSX - Clipboard not working</h2>
			<p class="meta">23 Feb 2017</p>
			
			<div class="post">
			<p>You can run Winforms applications on OSX by using Mono. Its looking sort of ugly, but most stuff works out of box. However there are some bugs, which make the usage of the application an annoyance. For example the clipboard is not working as expected. Copy and paste works in the application itself, but if you copy anything from another application on OSX. This means, that the application has its own clipboard. Setting the clipboard with <code>Clipboard.SetText("schlurps")</code> only sets the application internal clipboard.</p>

<p>This is a known issue (see <a href="https://bugzilla.xamarin.com/show_bug.cgi?id=3106">here</a>) and looking to the reported dates, I would not expect any</p>

<h2 id="the-workaround">The workaround</h2>

<p>On Stackoverflow is a <a href="http://stackoverflow.com/questions/28611112/mono-clipboard-fix">proposed and working solution</a> to copy data from the OSX clipboard and also retrieve data from it. It uses the <code>pbcopy</code> command for that.</p>

<p>While that works this is manual action. You can access the clipboard, but you cannot just paste from OSX. I made a workaround which involves a timer. The timer checks every 250ms if the content of the Mac-Clipboard has been changed. In that case the application clipboard is set.</p>

<p>Here is the class:</p>

<pre><code>public class MacClipboard
{
    private static String _osxClipboard = "";

    private static Timer _timer = new Timer();

    public static string OsxClipboard
    {
        get
        {
            return _osxClipboard;
        }

        set
        {
            _osxClipboard = value;
        }
    }
    
    public static void Init()
    {
        _timer.Interval = 250;
        _timer.Enabled = true;
        _timer.Tick += Timer_Tick;
    }

    private static void Timer_Tick(object sender, EventArgs e)
    {
        UpdateClipboard();
    }

    public static void UpdateClipboard()
    {
        String s = Paste();

        if (_osxClipboard != s)
        {
            _osxClipboard = s;
            Clipboard.SetText(s);
        }
    }


    /// &lt;summary&gt;
    /// Copy on MAC OS X using pbcopy commandline
    /// &lt;/summary&gt;
    /// &lt;param name="textToCopy"&gt;&lt;/param&gt;
    public static void Copy(string textToCopy)
    {
        try
        {
            using (var p = new Process())
            {

                p.StartInfo = new ProcessStartInfo("pbcopy", "-pboard general -Prefer txt");
                p.StartInfo.UseShellExecute = false;
                p.StartInfo.RedirectStandardOutput = false;
                p.StartInfo.RedirectStandardInput = true;
                p.Start();
                p.StandardInput.Write(textToCopy);
                p.StandardInput.Close();
                p.WaitForExit();
            }
        }
        catch (Exception ex)
        {
            Trace.WriteLine(ex.Message);
        }


    }

    /// &lt;summary&gt;
    /// Paste on MAC OS X using pbpaste commandline
    /// &lt;/summary&gt;
    /// &lt;returns&gt;&lt;/returns&gt;
    public static string Paste()
    {
        try
        {
            string pasteText;
            using (var p = new Process())
            {

                p.StartInfo = new ProcessStartInfo("pbpaste", "-pboard general");
                p.StartInfo.UseShellExecute = false;
                p.StartInfo.RedirectStandardOutput = true;
                p.Start();
                pasteText = p.StandardOutput.ReadToEnd();
                p.WaitForExit();
            }

            return pasteText;
        }
        catch (Exception ex)
        {
            Trace.WriteLine(ex.Message);
            return null;
        }

    }
}
</code></pre>

<p>I am only starting the timer on OSX in my application. If the user copies something into the clipboard it will be made available in the application clipboard. You can also set or the OSX clipboard manually. It should also be easy to extend the code for the other way around. If the application clipboard changes, the content could be copied back to the OSX clipboard.</p>

<p>Its not a very good implementation, but it works.</p>

			</div>
			
			<br>
			
			<div class="panel panel-default">
			  <div class="panel-heading">Support</div>
  				<div class="panel-body">
					<div class="row">
					  <div class="col-md-2">

<form action="https://www.paypal.com/cgi-bin/webscr" method="post" target="_top">
<input type="hidden" name="cmd" value="_s-xclick">
<input type="hidden" name="hosted_button_id" value="9UGVE4ZFX4UYS">
<input type="image" src="https://www.paypalobjects.com/en_GB/i/btn/btn_donate_LG.gif" border="0" name="submit" alt="PayPal – The safer, easier way to pay online.">
<img alt="" border="0" src="https://www.paypalobjects.com/de_DE/i/scr/pixel.gif" width="1" height="1">
</form>


					  </div>									    
		  	       </div>
			   </div>
			 </div>

			
			 <div class="panel panel-default">
			 	<div class="panel-heading">Verwandte Artikel:</div>
				<div class="panel-body">
				
				   <li class="list-unstyled"><a href="http://andydunkel.net/coding/programmierung/2017/02/02/debugger_funktioniert_nicht_mehr_c_charp.html" title="Visual Studio - Debugger geht nicht mehr">Visual Studio - Debugger geht nicht mehr</a></li>
				
				   <li class="list-unstyled"><a href="http://andydunkel.net/coding/programmierung/2017/02/01/resxmanager_fuer_c_charp.html" title="ResXManager - Übersetzungstool für .net Anwendungen">ResXManager - Übersetzungstool für .net Anwendungen</a></li>
				
				   <li class="list-unstyled"><a href="http://andydunkel.net/delphi/osx/2015/04/15/code_signing_problems_with_delphi.html" title="Code signing problems with Delphi: Entitlements.plist">Code signing problems with Delphi: Entitlements.plist</a></li>
				
				   <li class="list-unstyled"><a href="http://andydunkel.net/coding/tools/2014/02/04/check_code_signing_of_osx_applications.html" title="Check code signing of applications on OSX">Check code signing of applications on OSX</a></li>
				
				   <li class="list-unstyled"><a href="http://andydunkel.net/delphi/firemonkey/2014/01/28/code_signing_problems_with_delphi_xe4_and_mavericks.html" title="Code signing problems with Delphi XE4 Mavericks">Code signing problems with Delphi XE4 Mavericks</a></li>
				
				   <li class="list-unstyled"><a href="http://andydunkel.net/delphi/firemonkey/2014/01/22/signing_delphi_xe_applications_for_osx.html" title="Signing Firemonkey Applications on OSX">Signing Firemonkey Applications on OSX</a></li>
				
				   <li class="list-unstyled"><a href="http://andydunkel.net/mac/2013/06/19/backslash-unter-osx.html" title="Backslash unter OSX">Backslash unter OSX</a></li>
				
				</div>
			</div>
			
						
			<script type="text/javascript"><!--
			google_ad_client = "ca-pub-1137550895446814";
			/* 468x60, Erstellt 21.03.09 */
			google_ad_slot = "2357680339";
			google_ad_width = 468;
			google_ad_height = 60;
			//-->
			</script>
			<script type="text/javascript"
			src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
			</script>
    	</div>
    	
    	<div class="col-md-3" align="center">  
    	  	
    		<div class="panel panel-default">
	    		<div class="panel-body">
				<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
				<!-- Seitenleiste -->
				<ins class="adsbygoogle"
				     style="display:inline-block;width:160px;height:600px"
				     data-ad-client="ca-pub-1137550895446814"
				     data-ad-slot="1909195079"></ins>
				<script>
				(adsbygoogle = window.adsbygoogle || []).push({});
				</script>		    	
	    		</div>
    		</div>
    	</div>    	
    	
    </div>			

<hr>

<div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'andydunkelnet'; // required: replace example with your forum shortname
 		var disqus_config = function () {	        
    	    this.page.identifier = 'windows_forms_on_osx_clipboard_not_working';
    	};


        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    </div>
    
<!-- Piwik -->
<script type="text/javascript">
  var _paq = _paq || [];
  _paq.push(["trackPageView"]);
  _paq.push(["enableLinkTracking"]);

  (function() {
    var u=(("https:" == document.location.protocol) ? "https" : "http") + "://piwik.ekiwi.de/";
    _paq.push(["setTrackerUrl", u+"piwik.php"]);
    _paq.push(["setSiteId", "2"]);
    var d=document, g=d.createElement("script"), s=d.getElementsByTagName("script")[0]; g.type="text/javascript";
    g.defer=true; g.async=true; g.src=u+"piwik.js"; s.parentNode.insertBefore(g,s);
  })();
</script>
<!-- End Piwik Code -->

    </body>
</html>
