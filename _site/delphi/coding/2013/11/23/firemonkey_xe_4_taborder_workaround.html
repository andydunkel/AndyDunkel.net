<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
        <title>Delphi XE4/Firemonkey - Taborder not working + Workaround</title>
        <meta name="viewport" content="width=device-width">
        <link rel="stylesheet" href="/css/syntax.css">
        <script src="/css/jquery.js"></script>
        <link rel="stylesheet" href="/css/bootstrap.css">
		<link rel="stylesheet" href="/css/bootstrap-theme.css">		
		<script src="/css/bootstrap.js"></script>
		<link href="/css/additional.css" rel="stylesheet">
		<link rel="stylesheet" href="http://yandex.st/highlightjs/7.4/styles/default.min.css">
		<script src="http://yandex.st/highlightjs/7.4/highlight.min.js"></script>
		<link rel="alternate" type="application/rss+xml" title="AndyDunke.net RSS Feed" href="http://andydunkel.net/rss.xml" /> 
    </head>
    <body>
    
    <div class="container">
    	<div class="col-md-6">
	    	<a href="/index.html">
    			<img src="/assets/logo.png" alt="logo" width="450" height="135">
    		</a>
    	</div>
    	<div class="col-md-6" style="padding:40px">
	    	<script type="text/javascript"><!--
			google_ad_client = "ca-pub-1137550895446814";
			/* 468x60, Erstellt 21.03.09 */
			google_ad_slot = "2357680339";
			google_ad_width = 468;
			google_ad_height = 60;
			//-->
			</script>
			<script type="text/javascript"
			src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
			</script>    	
    	</div>
    </div>

    <!-- Fixed navbar -->
    <div class="navbar navbar-default">
      <div class="container">
	     
        <div class="navbar-header">	
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          
          <a class="navbar-brand" href="/index.html">Home</a>
        </div>
       
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li><a href="/blog.html">Blog</a></li>
            
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">Projekte <b class="caret"></b></a>
              <ul class="dropdown-menu">
	            <li><a href="/projects/php-debugging-vm/index.html">PHP-Debugging-VM</a></li>  
	            <li class="divider"></li>
                <li class="dropdown-header">Sonstiges / Other</li>
                <li><a href="/websites.html">Webseiten</a></li>
                <li><a href="/software.html">Software</a></li>
              </ul>
            </li>
            
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">Sonstiges <b class="caret"></b></a>
              <ul class="dropdown-menu">
                <li><a href="/documents.html">Dokumente</a></li>
              </ul>
            </li>
            
            <li><a href="/about.html">Pers√∂nliches</a></li>
            <li><a href="/contact.html">Kontakt</a></li>            
            <li><a href="/imprint.html">Impressum</a></li>
          </ul>
          <ul class="nav navbar-nav navbar-right">
          	<li>
          	<form action="http://www.google.de" id="cse-search-box" class="navbar-form navbar-left" role="search">
			  <div class="form-group">
			    <input type="hidden" name="cx" value="partner-pub-1137550895446814:8857383477" />
			    <input type="hidden" name="ie" value="UTF-8" />
			    <input type="text" name="q" size="20" class="form-control"/>
			  </div>
			    <input type="submit" name="sa" value="Search" class="btn btn-default"/>			
			  </form>
				<script type="text/javascript" src="http://www.google.de/coop/cse/brand?form=cse-search-box&amp;lang=de"></script>
          	</li>            
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </div>

    <div class="container">

        <div class="row">
    	<div class="col-md-9">

			<h2>Delphi XE4/Firemonkey - Taborder not working + Workaround</h2>
			<p class="meta">23 Nov 2013</p>
			
			<div class="post">
			<p>Firemonkey, the framework for cross plattform development, still seems to have some problems and bugs. :-( One of the problems I came across was that the TabOrder property was not working:</p>

<iframe width="640" height="360" src="//www.youtube.com/embed/adnmXK3xzyE" frameborder="0" allowfullscreen></iframe>

<p>The problem starts with the inability to set the TabOrder correctly in the designer. They are reset all the time to their defaults. When the application is running, the TabOrder works for some basic dialogs. In others dialogs nothing happens, or the tab key focuses the wrong control.</p>

<p>Looking up the bug database from Embarcadero, this is a known problem / bug. Some people in the internet suggest to set the TabOrder property programmatically during runtime, but that also did not work for me.</p>

<p>After a lot of trying, I found a workaround, that at least works for me. Since I could not set the TabOrder property, I used the HelpContext property (which I dont use in my application) to define the order of the controls:</p>

<p><img src="http://andydunkel.net/assets/uploads/2013/11/taborder/1.png" alt=""></p>

<p><em>Note: You can also use the Tag value, but I am using that one for my translation logic.</em></p>

<p>Next step was to create a class helper for TForm:</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">unit FormHelper;

interface

type
  TFormHelper = class helper for TForm
    procedure DoTabHandlingXE(comp : TForm; tabOrder : Integer);
  end;

implementation

//Workaround for Tab-Bug in Firemonkey
procedure TFormHelper.DoTabHandlingXE(comp: TForm; tabOrder : Integer);
var
  i, c :integer;
  current : TComponent;
  currentNext : integer;
  focus : TStyledControl;
begin
  c := Self.ComponentCount - 1;
  currentNext := 9999;
  focus := nil;

  for i := 0 to c do begin
      current := Self.Components[i];
      if (current is TStyledControl) then begin
          if ((current as TStyledControl).HelpContext &lt; currentNext) and 
          ((current as TStyledControl).HelpContext &gt; tabOrder) then begin
            currentNext := (current as TStyledControl).HelpContext;
          end;
      end;
  end;  

  for i := 0 to c do begin
      current := Self.Components[i];
      if (current is TStyledControl) then begin
        if (currentNext = (current as TStyledControl).HelpContext) then begin
          focus := (current as TStyledControl);
        end;
      end;
  end;

  if focus &lt;&gt; nil then begin
    focus.SetFocus;
  end;
end;
end.
</code></pre></div>
<p>I am sure there could be some optimizations done with that code, but it works. What we are doing here is to iterate over all controls of a given form and find the next higher value of the HelpContext. Thats the control we want to set focus, when the user hits the tab key.</p>

<p>Of course the code does nothing to far, since the method is not called yet. So the next step is to implement the KeyDown event in the form:</p>
<div class="highlight"><pre><code class="text language-text" data-lang="text">procedure TfrmEinzField.KeyDown(var Key: Word; var KeyChar: Char;
  Shift: TShiftState);
var
  control : TStyledControl;
begin
  if Key = vkTab then
  begin
    //custom handling
    if (Self.GetFocused is TStyledControl) then begin
      control := (Self.GetFocused as TStyledControl);
      DoTabHandlingXE(Self, control.HelpContext);
    end;
  end else
    inherited; //do default handling
end;
</code></pre></div>
<p>In the code, we get the currently focused control. Then we call the method we wrote before with the current Form variable and the controls HelpContext value.
With that workaround the tab key is now working as expected, jumping to the next control. </p>

			</div>
			
			<script type="text/javascript"><!--
			google_ad_client = "ca-pub-1137550895446814";
			/* 468x60, Erstellt 21.03.09 */
			google_ad_slot = "2357680339";
			google_ad_width = 468;
			google_ad_height = 60;
			//-->
			</script>
			<script type="text/javascript"
			src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
			</script>
    	</div>
    	
    	<div class="col-md-3" align="center">  
    		<div class="panel panel-default sideBarTop">    			
	    		<script id='fb7sm2s'>(function(i){var f,s=document.getElementById(i);f=document.createElement('iframe');f.src='//api.flattr.com/button/view/?uid=mengenleere&button=compact&url='+encodeURIComponent(document.URL);f.title='Flattr';f.height=20;f.width=110;f.style.borderWidth=0;s.parentNode.insertBefore(f,s);})('fb7sm2s');</script>    		
    		</div>
    	  	
    		<div class="panel panel-default">
	    		<div class="panel-body">
				<script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
				<!-- Seitenleiste -->
				<ins class="adsbygoogle"
				     style="display:inline-block;width:160px;height:600px"
				     data-ad-client="ca-pub-1137550895446814"
				     data-ad-slot="1909195079"></ins>
				<script>
				(adsbygoogle = window.adsbygoogle || []).push({});
				</script>		    	
	    		</div>
    		</div>
    	</div>    	
    	
    </div>			

<hr>

<div id="disqus_thread"></div>
    <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'andydunkelnet'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    </div>
    
    <!-- Piwik -->
<script type="text/javascript">
  var _paq = _paq || [];
  _paq.push(["trackPageView"]);
  _paq.push(["enableLinkTracking"]);

  (function() {
    var u=(("https:" == document.location.protocol) ? "https" : "http") + "://piwik.ekiwi.de/";
    _paq.push(["setTrackerUrl", u+"piwik.php"]);
    _paq.push(["setSiteId", "7"]);
    var d=document, g=d.createElement("script"), s=d.getElementsByTagName("script")[0]; g.type="text/javascript";
    g.defer=true; g.async=true; g.src=u+"piwik.js"; s.parentNode.insertBefore(g,s);
  })();
</script>
<!-- End Piwik Code -->

    </body>
</html>
